<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pr√©-cadastro - Comunidade Or√ßamentaria</title>
  <meta name="description" content="Fa√ßa parte da primeira rede social de Arquitetura e Constru√ß√£o Civil do Brasil">
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23231916'/><text x='50' y='64' font-family='Arial' font-size='52' font-weight='bold' text-anchor='middle' fill='white'>OB</text></svg>">

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root{
      /* Paleta Or√ßamentaria */
      --brand:#C04B3E;        /* terracota principal */
      --brand-2:#E0B08E;      /* bege quente de apoio */
      --brand-dark:#231916;   /* marrom muito escuro */
      --ink:#1f1f1f;
      --muted:#6e6e6e;
      --panel:#ffffff;
      --border:#e7e7e7;
      --bg:#ffffff;
    }

    body{
      font-family: system-ui, -apple-system,"Segoe UI", Roboto, Helvetica, Arial;
      min-height:100vh; color:var(--ink); background:var(--bg);
    }

    .container{
      max-width: 1100px;              /* ‚Üë para comportar 2 colunas */
      margin: 0 auto; padding: 24px;
      min-height:100vh; display:flex; flex-direction:column; justify-content:center;
    }

    .header{ text-align:center; margin-bottom:18px; }
    .brandbar{
      width:100%; height:8px; background:linear-gradient(90deg, var(--brand-dark), var(--brand));
      border-radius:999px; margin:0 auto 14px; max-width:220px;
    }
    .logo-wrap{ display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:6px; }
    .logo{
      width:64px; height:64px; border-radius:50%; overflow:hidden;
      display:grid; place-items:center; background:var(--brand-dark);
    }
    .logo img{ width:100%; height:100%; object-fit:cover; }
    .title{ font-size:28px; font-weight:800; color:var(--brand-dark); letter-spacing:.2px; }
    .subtitle{ color:var(--muted); font-weight:600; margin-top:4px; }

    .highlight{
      margin:14px auto 0; width:max-content; max-width:100%;
      background:linear-gradient(135deg, var(--brand), #d46a53);
      color:#fff; font-weight:800; padding:10px 16px; border-radius:999px;
      box-shadow:0 10px 24px rgba(192,75,62,.25);
    }

    /* ====== LAYOUT EM DUAS COLUNAS ====== */
    .two-col{
      display:grid; grid-template-columns: 1fr 1fr; gap:28px; align-items:start;
      margin-top:18px;
    }
    .promo{
      background:#fff; border:1px solid var(--border);
      border-radius:14px; box-shadow:0 8px 28px rgba(0,0,0,.06);
      padding:12px;
    }
    .promo img{
      width:100%; height:auto; display:block; border-radius:10px;
    }
    /* Fixa a pe√ßa no topo ao rolar, em telas largas (opcional) */
    @media (min-width: 1100px){
      .promo{ position: sticky; top: 24px; }
    }

    .form-container{
      background:var(--panel); border:1px solid var(--border);
      border-radius:14px; padding:26px; box-shadow:0 8px 28px rgba(0,0,0,.06);
    }

    .form-group{ margin-bottom:18px; }
    .form-label{ display:block; font-weight:800; margin-bottom:6px; color:var(--brand-dark); }
    .optional{ color:var(--muted); font-weight:500; font-size:13px; }

    .form-input, .form-select{
      width:100%; padding:14px 15px; border-radius:10px;
      border:2px solid var(--border); background:#fafafa; font-size:16px;
      transition:.2s border, .2s background, .2s box-shadow;
    }
    .form-input:focus, .form-select:focus{
      outline:none; border-color:var(--brand); background:#fff;
      box-shadow:0 0 0 3px rgba(192,75,62,.12);
    }

    .chip-wrap{ display:flex; flex-wrap:wrap; gap:10px; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      border:2px solid var(--border); padding:10px 12px; border-radius:999px;
      background:#fafafa; cursor:pointer; transition:.2s border, .2s background;
      user-select:none; font-weight:600; color:#333;
    }
    .chip input{ accent-color:var(--brand); transform:scale(1.1); }
    .chip.active{ border-color:var(--brand); background:#fff; }

    .hidden{ display:none !important; }

    .submit-btn{
      width:100%; padding:16px; border:none; border-radius:10px;
      background:linear-gradient(135deg, var(--brand), #d46a53);
      color:#fff; font-size:18px; font-weight:900; cursor:pointer;
      box-shadow:0 10px 24px rgba(192,75,62,.25); transition:.15s transform;
    }
    .submit-btn:hover{ transform:translateY(-2px); }
    .submit-btn:disabled{ background:#ececec; color:#9a9a9a; box-shadow:none; cursor:not-allowed; }

    .loading{ display:none; align-items:center; justify-content:center; gap:8px; }
    .spinner{ width:18px; height:18px; border:2px solid transparent; border-top:2px solid #fff; border-radius:50%; animation:spin 1s linear infinite; }
    @keyframes spin{ to{ transform:rotate(360deg) } }

    .success-message,.error-message{
      display:none; margin-top:18px; padding:16px; border-radius:10px; font-weight:800; text-align:center;
      border:1px solid;
    }
    .success-message{ background:#d4edda; color:#155724; border-color:#c3e6cb; }
    .error-message{ background:#f8d7da; color:#721c24; border-color:#f5c6cb; }

    .footer{ text-align:center; margin-top:22px; color:var(--muted); font-size:14px; }
    .footer a{ color:var(--brand); text-decoration:none; font-weight:700; }
    .footer a:hover{ text-decoration:underline; }

    /* Responsivo: empilha em uma coluna */
    @media (max-width: 900px){
      .two-col{ grid-template-columns: 1fr; }
    }
    @media (max-width: 560px){
      .container{ padding:16px; justify-content:flex-start; padding-top:26px; }
      .form-container{ padding:20px; }
      .title{ font-size:24px; }
      .logo{ width:56px; height:56px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brandbar" aria-hidden="true"></div>
      <div class="logo-wrap">
        <div class="logo">
          <!-- seu logo; est√° em /public ao lado do index.html -->
          <img src="/logo-orcamentaria.jpeg" alt="Logo Or√ßamentaria" onerror="this.parentElement.style.background='#231916'">
        </div>
        <h1 class="title">Comunidade Or√ßamentaria</h1>
      </div>
      <p class="subtitle">A primeira rede social de Arquitetura e Constru√ß√£o Civil do Brasil</p>
      <div class="highlight">üéâ Cadastre-se e ganhe 3 meses gr√°tis no lan√ßamento!</div>
    </div>

    <!-- ====== GRID 2 COLUNAS: IMAGEM | FORM ====== -->
    <div class="two-col">
      <!-- Coluna esquerda: pe√ßa visual -->
      <aside class="promo" aria-label="Pr√©via do perfil na Or√ßamentaria">
        <img src="/cartao-orcamentaria.png" alt="Pr√©via de perfil - Or√ßamentaria">
      </aside>

      <!-- Coluna direita: formul√°rio -->
      <div class="form-container">
        <form id="precadastroForm" novalidate>
          <div class="form-group">
            <label class="form-label" for="nome">Nome Completo</label>
            <input class="form-input" id="nome" name="nome" placeholder="Digite seu nome completo" required>
          </div>

          <div class="form-group">
            <label class="form-label" for="profissao">Profiss√£o</label>
            <select class="form-select" id="profissao" name="profissao" required>
              <option value="">Selecione sua profiss√£o</option>
              <option value="arquiteto">Arquiteto(a)</option>
              <option value="engenheiro">Engenheiro(a) Civil</option>
              <option value="prestador">Prestador de Servi√ßos</option>
              <option value="fornecedor">Fornecedor</option>
              <option value="construtor">Construtor</option>
              <option value="designer">Designer de Interiores</option>
              <option value="outro">Outro</option>
            </select>
          </div>

          <!-- Engenheiro: especialidade √∫nica -->
          <div id="groupEng" class="form-group hidden">
            <label class="form-label" for="especialidadeEng">Especialidade (Engenheiro Civil)</label>
            <select id="especialidadeEng" class="form-select">
              <option value="">Selecione sua especialidade</option>
              <option value="projetista">Engenheiro Projetista</option>
              <option value="gerenciamento-obras">Gerenciamento de Obras</option>
              <option value="orcamentista">Or√ßamentista</option>
            </select>
          </div>

          <!-- Prestador: m√∫ltipla escolha -->
          <div id="groupPrest" class="form-group hidden">
            <label class="form-label">Selecione suas especialidades (Prestador de Servi√ßos)</label>
            <div class="chip-wrap" id="chipsPrest">
              <label class="chip"><input type="checkbox" value="pedreiro"> Pedreiro</label>
              <label class="chip"><input type="checkbox" value="eletricista"> Eletricista</label>
              <label class="chip"><input type="checkbox" value="encanador"> Encanador</label>
              <label class="chip"><input type="checkbox" value="gesseiro"> Gesseiro</label>
              <label class="chip"><input type="checkbox" value="pintor"> Pintor</label>
              <label class="chip"><input type="checkbox" value="instalador-pisos"> Instalador de Pisos</label>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="empresa">Empresa <span class="optional">(opcional)</span></label>
            <input class="form-input" id="empresa" name="empresa" placeholder="Nome da sua empresa">
          </div>

          <div class="form-group">
            <label class="form-label" for="telefone">Telefone/WhatsApp</label>
            <input class="form-input" id="telefone" name="telefone" placeholder="(11) 99999-9999" required>
          </div>

          <div class="form-group">
            <label class="form-label" for="email">E-mail</label>
            <input class="form-input" type="email" id="email" name="email" placeholder="seu@email.com" required>
          </div>

          <div class="form-group">
            <label class="form-label" for="cidade">Cidade/Estado</label>
            <input class="form-input" id="cidade" name="cidade" placeholder="S√£o Paulo, SP" required>
          </div>

          <button type="submit" class="submit-btn" id="submitBtn">
            <span id="btnText">Fazer Pr√©-cadastro</span>
            <span class="loading" id="loading"><span class="spinner"></span> Enviando...</span>
          </button>
        </form>

        <div class="success-message" id="successMessage">
          ‚úÖ <strong>Cadastro realizado com sucesso!</strong><br/>
          Voc√™ receber√° novidades no seu e-mail e WhatsApp.
        </div>
        <div class="error-message" id="errorMessage">
          ‚ùå <strong>Erro ao realizar cadastro.</strong><br/>
          Tente novamente em alguns instantes.
        </div>
      </div>
    </div>

    <div class="footer">
      <p>¬© 2025 Or√ßamentaria - Todos os direitos reservados</p>
      <p><a href="mailto:contato@orcamentaria.com">contato@orcamentaria.com</a></p>
    </div>
  </div>

  <script>
    // m√°scara telefone
    document.getElementById('telefone').addEventListener('input', function(e){
      let v = e.target.value.replace(/\D/g,'');
      if(v.length <= 11){
        v = v.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
        if(v.length < 14) v = v.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
      }
      e.target.value = v;
    });

    // elementos din√¢micos
    const profSel   = document.getElementById('profissao');
    const groupEng  = document.getElementById('groupEng');
    const groupPrest= document.getElementById('groupPrest');
    const espEng    = document.getElementById('especialidadeEng');
    const chipsPrest= document.getElementById('chipsPrest');

    function updateByProf(){
      const v = (profSel.value || '').toLowerCase().trim();
      groupEng.classList.toggle('hidden',   v !== 'engenheiro');
      groupPrest.classList.toggle('hidden', v !== 'prestador');

      if(v !== 'engenheiro') espEng.value = '';
      if(v !== 'prestador'){
        chipsPrest.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
          cb.checked=false; cb.parentElement.classList.remove('active');
        });
      }
    }
    profSel.addEventListener('change', updateByProf);
    updateByProf();

    // UX dos chips
    chipsPrest?.addEventListener('change', (e)=>{
      if(e.target.matches('input[type="checkbox"]')){
        e.target.parentElement.classList.toggle('active', e.target.checked);
      }
    });

    // envio
    document.getElementById('precadastroForm').addEventListener('submit', async function(e){
      e.preventDefault();

      // valida√ß√µes condicionais
      const prof = (profSel.value||'').toLowerCase().trim();
      if(prof === 'engenheiro' && !groupEng.classList.contains('hidden') && !espEng.value){
        alert('Selecione sua especialidade (Engenheiro Civil).');
        espEng.focus(); return;
      }
      if(prof === 'prestador' && !groupPrest.classList.contains('hidden')){
        const escolhidas = Array.from(chipsPrest.querySelectorAll('input:checked')).map(i=>i.value);
        if(escolhidas.length === 0){
          alert('Selecione ao menos uma especialidade (Prestador de Servi√ßos).');
          chipsPrest.querySelector('input').focus(); return;
        }
      }

      const submitBtn = document.getElementById('submitBtn');
      const btnText   = document.getElementById('btnText');
      const loading   = document.getElementById('loading');
      const okMsg     = document.getElementById('successMessage');
      const errMsg    = document.getElementById('errorMessage');

      submitBtn.disabled = true; btnText.style.display='none'; loading.style.display='inline-flex';
      okMsg.style.display='none'; errMsg.style.display='none';

      // Unificar especialidades em um √∫nico array
      let especialidades = [];
      
      if (prof === 'engenheiro' && espEng.value) {
        especialidades = [espEng.value];
      } else if (prof === 'prestador') {
        especialidades = Array.from(chipsPrest.querySelectorAll('input:checked')).map(i=>i.value);
      }

      const formData = {
        nome:    document.getElementById('nome').value,
        profissao: profSel.value,
        especialidades: especialidades,
        empresa: document.getElementById('empresa').value,
        telefone:document.getElementById('telefone').value,
        email:   document.getElementById('email').value,
        cidade:  document.getElementById('cidade').value
      };

      try{
        const response = await fetch('/api/precadastro', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify(formData)
        });
        if(!response.ok) throw new Error('Erro no servidor');

        okMsg.style.display='block';
        document.getElementById('precadastroForm').reset();
        updateByProf();
        okMsg.scrollIntoView({behavior:'smooth'});
      }catch(err){
        console.error(err);
        errMsg.style.display='block';
        errMsg.scrollIntoView({behavior:'smooth'});
      }finally{
        submitBtn.disabled=false; btnText.style.display='inline'; loading.style.display='none';
      }
    });

    console.log('P√°gina de pr√©-cadastro carregada:', new Date().toISOString());
  </script>
</body>
</html>
